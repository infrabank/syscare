<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>예방 점검 예약하기 - SYSCARE</title>
    <meta name="description" content="SYSCARE 예방 점검 서비스를 예약하세요. 전산 시스템의 안전을 미리 확보하세요.">
    
    <!-- Pretendard Font -->
    <link rel="preload" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    
    <!-- CSS Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'Roboto', 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="font-sans bg-gray-50 text-gray-900">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-white/95 backdrop-blur-sm z-50 border-b border-gray-100">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center">
                <a href="index.html" class="text-2xl font-bold text-blue-600">SYSCARE</a>
            </div>
            <div class="hidden md:flex space-x-8">
                <a href="index.html#solution" class="text-gray-700 hover:text-blue-600 transition-colors">솔루션</a>
                <a href="index.html#values" class="text-gray-700 hover:text-blue-600 transition-colors">차별화</a>
                <a href="index.html#results" class="text-gray-700 hover:text-blue-600 transition-colors">효과</a>
                <a href="diagnosis.html" class="text-gray-700 hover:text-blue-600 transition-colors">무료 진단</a>
                <a href="system-check.html" class="text-gray-700 hover:text-blue-600 transition-colors">상태 확인</a>
                <a href="regular-checkup.html" class="text-gray-700 hover:text-blue-600 transition-colors">서비스비용</a>
            </div>
            <a href="index.html" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                홈으로
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-20">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-12">
                    <h1 class="text-4xl md:text-5xl font-bold mb-6 text-gray-900">
                        예방 점검 <span class="text-blue-600">예약하기</span>
                    </h1>
                    <p class="text-xl text-gray-700 mb-8">
                        문제가 생기기 전에 미리 점검하여 안전한 전산 환경을 만들어보세요.
                    </p>
                    <div class="bg-blue-50 p-6 rounded-xl border-l-4 border-blue-600">
                        <div class="flex items-center justify-center mb-4">
                            <i class="fas fa-info-circle text-blue-600 text-2xl mr-3"></i>
                            <span class="text-lg font-semibold text-blue-800">예방 점검의 장점</span>
                        </div>
                        <div class="grid md:grid-cols-3 gap-4 text-sm text-blue-700">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle mr-2 text-green-600"></i>
                                사전 위험 요소 발견
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-check-circle mr-2 text-green-600"></i>
                                복구 비용 최소화
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-check-circle mr-2 text-green-600"></i>
                                시스템 안정성 향상
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Google Form Embed -->
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold mb-4 text-gray-900">예약 정보 입력</h2>
                        <p class="text-gray-600">아래 양식을 작성해주시면 담당자가 빠르게 연락드리겠습니다.</p>
                    </div>
                    
                    <!-- Google Form placeholder -->
                    <div class="w-full bg-gray-100 p-8 rounded-lg text-center">
                        <i class="fas fa-forms text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2 text-gray-700">Google Forms 연동 준비됨</h3>
                        <p class="text-gray-600 mb-6">
                            실제 구글 폼을 생성하신 후 아래 설정을 통해 연동하실 수 있습니다.
                        </p>
                        <div class="bg-blue-50 p-4 rounded-lg text-left max-w-2xl mx-auto">
                            <h4 class="font-semibold text-blue-900 mb-2">구글 폼 연동 방법:</h4>
                            <ol class="text-sm text-blue-800 space-y-1">
                                <li>1. Google Forms에서 예약 폼 생성</li>
                                <li>2. 폼 설정에서 "응답" → "임베드 코드" 복사</li>
                                <li>3. 위 iframe src에 해당 URL 입력</li>
                                <li>4. ?embedded=true 파라미터 추가</li>
                            </ol>
                        </div>
                        <p class="text-xs text-gray-500 mt-4">
                            현재는 아래 대체 폼을 사용하실 수 있습니다.
                        </p>
                    </div>
                    
                    <!-- Booking Form -->
                    <div id="fallbackForm" class="mt-8">
                        <form id="bookingForm" class="space-y-6">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">회사명 *</label>
                                    <input type="text" name="company_name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">담당자명 *</label>
                                    <input type="text" name="contact_name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">연락처 *</label>
                                    <input type="tel" name="phone" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">이메일 *</label>
                                    <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">현재 사용 중인 시스템</label>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="systems" value="Windows Server" class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-gray-700">Windows Server</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="systems" value="Linux Server" class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-gray-700">Linux Server</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="systems" value="Network Equipment" class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-gray-700">네트워크 장비</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="systems" value="Database" class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-gray-700">데이터베이스</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">희망 점검 일정</label>
                                <select name="preferred_schedule" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">선택하세요</option>
                                    <option value="ASAP">가능한 빠른 시일 내</option>
                                    <option value="This Week">이번 주 내</option>
                                    <option value="Next Week">다음 주</option>
                                    <option value="Next Month">다음 달</option>
                                    <option value="Negotiable">별도 협의</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">특이사항 및 요청사항</label>
                                <textarea name="special_notes" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="점검 시 특별히 확인하고 싶은 부분이나 현재 겪고 있는 문제가 있다면 알려주세요."></textarea>
                            </div>
                            
                            <div class="text-center">
                                <button type="submit" id="submitButton" class="bg-blue-600 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-blue-700 transition-all shadow-lg">
                                    <i class="fas fa-paper-plane mr-2"></i>
                                    예약 신청하기
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Contact Info -->
                <div class="mt-12 grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold mb-4 text-gray-900">
                            <i class="fas fa-phone text-blue-600 mr-2"></i>
                            전화 상담
                        </h3>
                        <p class="text-gray-700 mb-4">급하신 경우 전화로 바로 상담받으세요.</p>
                        <a href="tel:070-8015-8079" class="text-2xl font-bold text-blue-600 hover:text-blue-700">
                            070-8015-8079
                        </a>
                        <p class="text-sm text-gray-500 mt-2">평일 09:00 - 18:00</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold mb-4 text-gray-900">
                            <i class="fas fa-envelope text-blue-600 mr-2"></i>
                            이메일 문의
                        </h3>
                        <p class="text-gray-700 mb-4">자세한 문의사항은 이메일로 보내주세요.</p>
                        <a href="mailto:jhw@mlkit.co.kr" class="text-lg font-semibold text-blue-600 hover:text-blue-700">
                            jhw@mlkit.co.kr
                        </a>
                        <p class="text-sm text-gray-500 mt-2">24시간 접수 가능</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="container mx-auto px-4 text-center">
            <div class="text-2xl font-bold text-blue-400 mb-4">SYSCARE</div>
            <p class="text-gray-400 mb-4">복구가 아니라 예방으로 당신의 전산을 지켜드립니다.</p>
            <div class="text-gray-500">
                <p>&copy; 2024 SYSCARE. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Google Form 로딩 실패 시 fallback 처리
        setTimeout(function() {
            const iframe = document.querySelector('iframe');
            const fallback = document.getElementById('fallbackForm');
            
            iframe.addEventListener('error', function() {
                iframe.style.display = 'none';
                fallback.classList.remove('hidden');
            });
        }, 3000);
        
        // Booking form submission
        const bookingForm = document.getElementById('bookingForm');
        if (bookingForm) {
            bookingForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = document.getElementById('submitButton');
            const originalText = submitButton.innerHTML;
            
            // Show loading state
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>처리 중...';
            submitButton.disabled = true;
            
            try {
                // Collect form data
                const formData = new FormData(this);
                
                // Process systems checkboxes
                const systems = [];
                formData.getAll('systems').forEach(system => {
                    systems.push(system);
                });
                
                // Prepare data for database
                const bookingData = {
                    company_name: formData.get('company_name'),
                    contact_name: formData.get('contact_name'),
                    phone: formData.get('phone'),
                    email: formData.get('email'),
                    systems: systems,
                    preferred_schedule: formData.get('preferred_schedule'),
                    special_notes: formData.get('special_notes') || '',
                    request_date: new Date().toISOString(),
                    status: '접수'
                };
                
                // Save to database
                const response = await fetch('tables/booking_requests', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bookingData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // Show success message
                    submitButton.innerHTML = '<i class="fas fa-check mr-2"></i>접수 완료!';
                    submitButton.className = 'bg-green-600 text-white px-8 py-4 rounded-lg text-lg font-semibold cursor-not-allowed';
                    
                    // Show success dialog
                    setTimeout(() => {
                        showSuccessModal(result);
                        
                        // Reset form after 3 seconds
                        setTimeout(() => {
                            this.reset();
                            submitButton.innerHTML = originalText;
                            submitButton.className = 'bg-blue-600 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-blue-700 transition-all shadow-lg';
                            submitButton.disabled = false;
                        }, 3000);
                    }, 1000);
                    
                } else {
                    throw new Error('서버 오류가 발생했습니다.');
                }
                
            } catch (error) {
                console.error('Error:', error);
                
                // Show error state
                submitButton.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>오류 발생';
                submitButton.className = 'bg-red-600 text-white px-8 py-4 rounded-lg text-lg font-semibold';
                
                alert('예약 신청 중 오류가 발생했습니다. 전화(070-8015-8079)로 연락주시거나 잠시 후 다시 시도해주세요.');
                
                // Reset button after 3 seconds
                setTimeout(() => {
                    submitButton.innerHTML = originalText;
                    submitButton.className = 'bg-blue-600 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-blue-700 transition-all shadow-lg';
                    submitButton.disabled = false;
                }, 3000);
            }
        });
        
        // Success modal
        function showSuccessModal(data) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-md w-full mx-4 p-8 text-center">
                    <div class="text-green-600 text-6xl mb-4">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">예약 접수 완료!</h2>
                    <p class="text-gray-700 mb-6">
                        예방 점검 예약이 성공적으로 접수되었습니다.<br>
                        <strong>접수번호: ${data.id.substring(0, 8)}</strong>
                    </p>
                    <div class="bg-blue-50 p-4 rounded-lg mb-6 text-left">
                        <h3 class="font-semibold text-blue-800 mb-2">다음 단계</h3>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li>• 24시간 내 담당자 연락</li>
                            <li>• 방문 일정 조율</li>
                            <li>• 예방 점검 실시</li>
                            <li>• 결과 리포트 제공</li>
                        </ul>
                    </div>
                    <div class="space-y-3">
                        <button onclick="exportToGoogleSheets('${data.id}')" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-table mr-2"></i>
                            구글 시트로 내보내기
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="w-full bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700 transition-colors">
                            확인
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Export to Google Sheets function
        async function exportToGoogleSheets(recordId) {
            try {
                // Get the record data
                const response = await fetch(`tables/booking_requests/${recordId}`);
                const record = await response.json();
                
                // Format data for Google Sheets
                const sheetData = [
                    ['접수일시', new Date(record.request_date).toLocaleString('ko-KR')],
                    ['회사명', record.company_name],
                    ['담당자명', record.contact_name],
                    ['연락처', record.phone],
                    ['이메일', record.email],
                    ['시스템', record.systems.join(', ')],
                    ['희망일정', record.preferred_schedule],
                    ['특이사항', record.special_notes],
                    ['상태', record.status],
                    ['접수번호', record.id]
                ];
                
                // Create CSV content
                const csvContent = sheetData.map(row => 
                    row.map(cell => `"${cell || ''}"`).join(',')
                ).join('\n');
                
                // Create downloadable file
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `예방점검예약_${record.company_name}_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Show instructions for Google Sheets
                setTimeout(() => {
                    alert(`CSV 파일이 다운로드되었습니다!\n\n구글 시트에 추가하는 방법:\n1. 구글 시트 열기 (${window.location.origin})\n2. 파일 > 가져오기 > 업로드\n3. 다운로드된 CSV 파일 선택\n4. "데이터 추가" 선택하여 기존 데이터에 추가`);
                }, 500);
                
            } catch (error) {
                console.error('Export error:', error);
                alert('내보내기 중 오류가 발생했습니다. 관리자에게 문의해주세요.');
            }
        }
        } // bookingForm exists check closing bracket
    </script>
</body>
</html>